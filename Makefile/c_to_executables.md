# 从 C :monkey:代码到可执行文件的完整流程

过程主要包含:four:个阶段：**预处理**、**编译**、**汇编**和**链接**。

---

## 1. 预处理

### 主要任务：
* **处理宏定义（`#define`）**：展开所有的宏，将宏名替换为它的值
* **处理条件编译指令（`#if`, `#ifdef`, `#ifndef`, `#else`, `#elif`, `#endif`）**：根据条件保留或排除代码块
* **处理文件==包含==（`#include`）**：将包含的头文件（如 `stdio.h`）的内容插入到该指令的位置
* **删除==注释==**：将所有注释（`//` 和 `/* ... */`）替换为空格

### 输入与输出：
* **输入**：`.c`源文件
* **输出**：预处理后的源文件（ `.i` 文件）
----
## 2. 编译 
编译阶段将==预处理后的源代码==（`.i `文件）转换为特定平台的**汇编代码**。该步骤由**编译器**完成

### 主要任务：
* **词法分析**：将源代码分解为一系列记号，如关键字、标识符、常量等
* **语义分析**：检查程序语义是否正确
* **中间代码生成**
* **代码优化和生成**
### 输入与输出：
* **输入**：预处理后的 `.i `文件
* **输出**：汇编语言文件（`.s `文件）
----
## 3.汇编
汇编阶段将汇编代码（.s 文件）转换为==机器指令==:robot:，并生成目标文件（.o或.obj）。该步骤由汇编器完成

### 主要任务：
* 将汇编指令逐条转换为机器指令（**二进制形式**）。

* 生成目标文件（.o），其中包含：

    * ***代码段***（.text）：存放机器指令。

    * ***数据段***：存放初始化全局变量和未初始化全局变量。

    * ***符号表***：记录程序中定义的符号（如函数名、全局变量）及其属性。

    * ***重定位信息***：记录需要链接器修改的地址（如外部函数调用）。
-----
## 4. 链接
链接是最后一步，由链接器（l将一个或多个目标文件（以及库文件）组合成一个可执行文件。

### 主要任务：
* **==符号解析==**：将每个符号引用与符号定义关联起来（如函数调用找到函数实现）。

* **==重定位==**：将每个符号的地址进行修正，使其指向正确的内存位置。

* **==合并目标文件==**：将多个目标文件的相同段（如 .text、.data）合并。

* **==链接库文件==**

### 输入与输出：
* **输入**：目标文件（.o）和库文件（.a, .so 等）
* **输出**：可执行文件（如 a.out（**unix**系统的默认可执行文件名）、hello.exe）